<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PowerShell is configured to use Constrained Language Mode. - ISM Controls Guide</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: #0d1117;
      min-height: 100vh;
      color: #e6edf3;
      text-align: left;
    }
    .header {
      background: #161b22;
      border-bottom: 1px solid #30363d;
      padding: 15px 40px;
      position: sticky;
      top: 0;
      z-index: 100;
      display: flex;
      align-items: center;
      gap: 20px;
    }
    .back-btn {
      background: #21262d;
      border: 1px solid #30363d;
      color: white;
      padding: 10px 20px;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
    }
    .back-btn:hover {
      border-color: #58a6ff;
      color: #58a6ff;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 30px 20px;
    }
    .content-card {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 6px;
      padding: 40px;
      text-align: left;
    }
    h1 {
      font-size: 1.8rem;
      font-weight: 700;
      color: #e6edf3;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #30363d;
    }
    h2 {
      font-size: 1.4rem;
      font-weight: 600;
      color: #e6edf3;
      margin-top: 30px;
      margin-bottom: 15px;
    }
    h3 {
      font-size: 1.2rem;
      font-weight: 600;
      color: #8b949e;
      margin-top: 25px;
      margin-bottom: 12px;
    }
    p { line-height: 1.7; margin-bottom: 15px; color: #8b949e; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      font-size: 0.95rem;
    }
    th, td {
      padding: 12px 15px;
      border: 1px solid #30363d;
      text-align: left;
    }
    th {
      background: #21262d;
      color: #e6edf3;
      font-weight: 600;
    }
    tr:nth-child(even) { background: #161b22; }
    tr:nth-child(odd) { background: #0d1117; }
    ul, ol { margin: 15px 0; padding-left: 25px; color: #8b949e; }
    li { margin-bottom: 8px; line-height: 1.6; }
    a { color: #58a6ff; text-decoration: none; font-weight: 500; }
    a:hover { text-decoration: underline; }
    code {
      background: #21262d;
      padding: 3px 8px;
      border-radius: 4px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 0.9em;
      color: #e6edf3;
    }
    pre {
      background: #161b22;
      color: #e6edf3;
      padding: 20px;
      border-radius: 6px;
      overflow-x: auto;
      margin: 20px 0;
      border: 1px solid #30363d;
    }
    pre code { background: none; padding: 0; color: inherit; }
    blockquote {
      border-left: 4px solid #58a6ff;
      padding: 15px 20px;
      margin: 20px 0;
      background: rgba(88, 166, 255, 0.1);
      border-radius: 0 6px 6px 0;
    }
    blockquote p { margin: 0; color: #e6edf3; }
    hr { border: none; border-top: 1px solid #30363d; margin: 30px 0; }
    @media (max-width: 768px) {
      .header { padding: 15px 20px; }
      .content-card { padding: 25px; }
      h1 { font-size: 1.5rem; }
    }

  </style>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <div class="header">
    <a href="../" class="back-btn">← Back to Controls</a>
  </div>
  <div class="container">
    <div class="content-card" id="content">
    </div>
  </div>
  <script>
    const markdown = `---
title: "PowerShell is configured to use Constrained Language Mode. (ISM-1622)"
ism_control: "ISM-1622"
revision: "0"
updated: "Oct-20"
guideline: "Guidelines for system hardening"
section: "Operating system hardening"
topic: "PowerShell"
essential_eight:
  - "ML3"
pspf_levels:
  - "NC"
  - "OS"
  - "P"
  - "S"
  - "TS"
date_generated: "2025-12-25"
---
# PowerShell is configured to use Constrained Language Mode.

| Property | Value |
|----------|-------|
| **ISM Control** | ISM-1622 |
| **Revision** | 0 |
| **Updated** | Oct-20 |
| **Guideline** | Guidelines for system hardening |
| **Section** | Operating system hardening |
| **Topic** | PowerShell |
| **Essential Eight** | ML3 |
| **PSPF Levels** | NC, OS, P, S, TS |

## Summary

PowerShell is configured to run in Constrained Language Mode as part of the Essential Eight Application Control mitigations.[^2] Enable Constrained Language Mode by deploying a WDAC policy enforced through Intune; WDAC policies can be deployed via Intune for centralized enforcement.[^1] WDAC is the preferred enforcement mechanism, and Intune provides a supported deployment path for policy enforcement.[^1]

[^1]:Essential Eight application control - Essential Eight | Microsoft Learn(https://learn.microsoft.com/en-us/compliance/anz/e8-app-control)
[^2]:Essential Eight user application hardening - Essential Eight | Microsoft Learn(https://learn.microsoft.com/en-us/compliance/anz/e8-app-harden)

## Design Decision

> [!NOTE] Constrained Language Mode will be enabled via a WDAC policy enforced through Intune.

## Prerequisites

* **Licensing:** Microsoft 365-related licensing requirements described in Microsoft 365 and Office 365 service descriptions. [^1]
* **Permissions/Roles:** Appropriate permissions by administrators across the solutions used within this document. [^1]
* **Dependencies:** Windows 11 22H2 Enterprise; Intune for management solution; Defender for Endpoint; Microsoft Sentinel for Security information and event management. [^1]

[^1]:[Essential Eight application control - Essential Eight | Microsoft Learn](https://learn.microsoft.com/en-us/compliance/anz/e8-app-control)

## Implementation Steps

### Enable Constrained Language Mode via WDAC policy enforced through Intune

1. Create a WDAC audit policy using the Windows Defender App Control Wizard.
   - Open the Windows Defender App Control Wizard and select Policy Creator.
   - Choose Multiple Policy Format and Base Policy, then select Next.
   - In Policy Template, select Default Windows Mode or Allow Microsoft Mode. This document uses Allow Microsoft Mode. [^1]
   - Modify Policy Name and Policy File Location as needed, then select Next.
   - Within Policy Rules, configure:
     - Disable Script Enforcement: Disabled
     - Intelligent Security Graph: Disabled
     - Managed installer: Enabled
     - User Mode Code Integrity: Required
     - Allow Supplement Policies: Required
   - In Policy Signing Rules, add any required signers as needed. [^1]
   - Continue to Next and create the policy. The wizard generates an XML policy and a GUID-based identity for the policy. [^1]
   - Note: Microsoft recommends using publisher-based rules where appropriate and, if needed, hash-based rules for unsigned references. [^1]

2. Deploy the WDAC audit policy via Intune.
   1. Sign in to Intune admin center.
   2. Devices > Configuration Profiles > Create Profile.
   3. Platform: Windows 10 or later; Profile type: Templates > Custom.
   4. Name the policy (for example, "Application Control – Microsoft Allow – Audit") and select Next.
   5. Under OMA-URI Settings, Add:
      - OMA-URI: ./Vendor/MSFT/ApplicationControl/Policies/<PolicyGUID>/Policy
      - Data Type: Base64 (File)
      - Note: Replace <PolicyGUID> with the PolicyTypeID found in the generated policy XML (mergedPolicy.xml produced by the WDAC Wizard) [^1].
   6. Copy the CIP file generated by the WDAC Wizard (GUID).CIP, rename to .BIN (for example, {GUID}.bin).
   7. Upload the BIN under Base64 (File).
   8. Save and deploy the profile to the intended group.
   9. Follow prompts to complete deployment. The policy will be deployed as an audit policy to the target devices. [^1]
   10. Monitor deployment status and verify policy XML and CIP/BIN alignment with the policy GUID. [^1]

3. Switch to enforce policy.
   1. Open the Windows Defender App Control Wizard and select Policy Editor.
   2. Open the policy XML to be changed to enforced and disable Audit Mode under Policy Rules.
   3. Select Next within Policy Rules.
   4. Create an Update Policy with an amended version and a new CIP file.
   5. In Intune, go to Devices > Configuration Profiles > Create Profile (Windows 10 or later, Custom).
   6. Name the profile (e.g., "Application Control – Enforce Policy") and select Next.
   7. Under OMA-URI Settings, Add:
      - OMA-URI: ./Vendor/MSFT/ApplicationControl/Policies/<PolicyGUID>/Policy
      - Data Type: Base64 (File)
      - Note: Policy GUID must match the PolicyTypeID in the mergedPolicy.xml generated earlier. [^1]
   8. Copy the new CIP file and rename to .BIN (e.g., {GUID}.bin).
   9. Upload the BIN under Base64 (File).
   10. Save and deploy the Enforce Policy configuration profile to the intended system.
   11. Exclude the previously deployed audit policy from enforcement if required. [^1]
   12. Reboot the target devices to apply the enforced WDAC policy. [^1]
   13. Validate that enforcement is active and that only organization-approved code is allowed to run. [^1]
   14. Monitor WDAC events and adjust policy as needed. [^1]

4. Validate Constrained Language Mode and WDAC enforcement.
   - Validate WDAC enforcement status on enrolled devices and confirm Constrained Language Mode is active for PowerShell.
   - Use centralized monitoring or Defender for Endpoint/Explorer workflows to verify enforcement and log generation. [^2]
   - Optionally use a WDAC-aware extension or tooling to detect enforcement; refer to WDAC enforcement checks documented for WDAC-enabled infrastructure management. [^3]

5. Referenced scripts and additional hardening guidance.
   - For related hardening scripts referenced in this guidance, see:
     - OfficeMacroHardening-PreventActivationofOLE.ps1. https://github.com/microsoft/Intune-ACSC-Windows-Hardening-Guidelines/blob/main/office/scripts/OfficeMacroHardening-PreventActivationofOLE.ps1
     - UserApplicationHardening-RemoveFeatures.ps1. https://github.com/microsoft/Intune-ACSC-Windows-Hardening-Guidelines/blob/main/scripts/UserApplicationHardening-RemoveFeatures.ps1
   - These scripts are referenced remotely in the context of supporting the Essential Eight hardening guidance. [^2]

Notes and references
- The steps above derive from the WDAC-based Essential Eight guidance for implementing application control and WDAC via Intune, including policy design, audit deployment, and transition to enforcement. [^1]
- Constrained Language Mode is the guardrail that WDAC policies help enforce for PowerShell and related language features as part of the Essential Eight control set. [^2]
- WDAC enforcement status and related extension-based verification approaches are documented for WDAC-enforced infrastructure management. [^3]

Footnotes
- [^1]:Essential Eight application control - Essential Eight | Microsoft Learn. https://learn.microsoft.com/en-us/compliance/anz/e8-app-control
- [^2]:Essential Eight user application hardening - Essential Eight | Microsoft Learn. https://learn.microsoft.com/en-us/compliance/anz/e8-app-harden
- [^3]:Extension support for the management of Windows Defender Application Control (WDAC) enforced infrastructure - Microsoft Learn. https://learn.microsoft.com/en-us/windows-server/manage/windows-admin-center/extend/guides/application-control-infrastructure-extensions`;
    const contentWithoutFrontmatter = markdown.replace(/^---[\s\S]*?---\s*/m, '');
    document.getElementById('content').innerHTML = marked.parse(contentWithoutFrontmatter);
  </script>
</body>
</html>