<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Only Microsoft Office macros running from within a sandboxed environment, a Trusted Location or that are digitally signed by a trusted publisher are allowed to execute. (ISM-1674) - ISM Controls Guide</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
      text-align: left;
    }
    .header {
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(10px);
      padding: 15px 40px;
      box-shadow: 0 2px 20px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 100;
      display: flex;
      align-items: center;
      gap: 20px;
    }
    .back-btn {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
    }
    .back-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }
    .header-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: #1a1a2e;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 30px 20px;
    }
    .content-card {
      background: white;
      border-radius: 16px;
      padding: 40px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.15);
      text-align: left;
    }
    h1 {
      font-size: 1.8rem;
      font-weight: 700;
      color: #1a1a2e;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 3px solid #667eea;
    }
    h2 {
      font-size: 1.4rem;
      font-weight: 600;
      color: #333;
      margin-top: 30px;
      margin-bottom: 15px;
    }
    h3 {
      font-size: 1.2rem;
      font-weight: 600;
      color: #444;
      margin-top: 25px;
      margin-bottom: 12px;
    }
    p { line-height: 1.7; margin-bottom: 15px; color: #444; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      font-size: 0.95rem;
    }
    th, td {
      padding: 12px 15px;
      border: 1px solid #e0e0e0;
      text-align: left;
    }
    th {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      font-weight: 600;
    }
    tr:nth-child(even) { background: #f8f9fa; }
    ul, ol { margin: 15px 0; padding-left: 25px; }
    li { margin-bottom: 8px; line-height: 1.6; }
    a { color: #667eea; text-decoration: none; font-weight: 500; }
    a:hover { text-decoration: underline; }
    code {
      background: #f1f3f4;
      padding: 3px 8px;
      border-radius: 4px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 0.9em;
    }
    pre {
      background: #1a1a2e;
      color: #e0e0e0;
      padding: 20px;
      border-radius: 10px;
      overflow-x: auto;
      margin: 20px 0;
    }
    pre code { background: none; padding: 0; color: inherit; }
    blockquote {
      border-left: 4px solid #667eea;
      padding: 15px 20px;
      margin: 20px 0;
      background: #f8f9ff;
      border-radius: 0 8px 8px 0;
    }
    blockquote p { margin: 0; }
    hr { border: none; border-top: 2px solid #e0e0e0; margin: 30px 0; }
    @media (max-width: 768px) {
      .header { padding: 15px 20px; flex-direction: column; align-items: flex-start; gap: 10px; }
      .content-card { padding: 25px; }
      h1 { font-size: 1.5rem; }
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <div class="header">
    <a href="../" class="back-btn">← Back to Controls</a>
    <span class="header-title">Only Microsoft Office macros running from within a sandboxed environment, a Trusted Location or that are digitally signed by a trusted publisher are allowed to execute. (ISM-1674)</span>
  </div>
  <div class="container">
    <div class="content-card" id="content">
    </div>
  </div>
  <script>
    const markdown = `---
title: "Only Microsoft Office macros running from within a sandboxed environment, a Trusted Location or that are digitally signed by a trusted publisher are allowed to execute. (ISM-1674)"
ism_control: "ISM-1674"
revision: "0"
updated: "Sep-21"
guideline: "Guidelines for system hardening"
section: "User application hardening"
topic: "Microsoft Office macros"
essential_eight:
  - "ML3"
pspf_levels:
  - "NC"
  - "OS"
  - "P"
  - "S"
  - "TS"
date_generated: "2025-12-25"
---
# Only Microsoft Office macros running from within a sandboxed environment, a Trusted Location or that are digitally signed by a trusted publisher are allowed to execute. (ISM-1674)

| Property | Value |
|----------|-------|
| **ISM Control** | ISM-1674 |
| **Revision** | 0 |
| **Updated** | Sep-21 |
| **Guideline** | Guidelines for system hardening |
| **Section** | User application hardening |
| **Topic** | Microsoft Office macros |
| **Essential Eight** | ML3 |
| **PSPF Levels** | NC, OS, P, S, TS |

## Summary

Only Microsoft Office macros that are digitally signed by a trusted publisher and governed by Intune policy are allowed to run[^3][^4]. Implement Intune-based controls to block macros from untrusted sources and to enable execution only for macros signed by trusted publishers, as outlined by ACSC hardening guidance[^3]. To realize this, distribute the code-signing certificate to devices and configure the Trusted Publishers store so macros from that publisher are trusted; macros signed by the same certificate are treated as coming from a trusted publisher[^4]. Macros from the internet are blocked by default, reinforcing the trusted-publisher approach over relying on Trusted Locations[^2].

[^2]:Macros from the internet are blocked by default in Office - Microsoft 365 Apps | Microsoft Learn(https://learn.microsoft.com/en-us/microsoft-365-apps/security/internet-macros-blocked)
[^3]:List of settings for the Microsoft 365 Apps for Enterprise security baseline in Intune - Microsoft Intune | Microsoft Learn(https://learn.microsoft.com/en-us/intune/intune-service/protect/security-baseline-v2-office-settings)
[^4]:Trusted publishers for Office files - Microsoft 365 Apps | Microsoft Learn(https://learn.microsoft.com/en-us/microsoft-365-apps/security/trusted-publisher)

## Design Decision

> [!NOTE] The design restricts Office macros to those signed by trusted publishers and enforces this via Intune policy. This ensures only macros signed by trusted publishers are allowed to execute.

## Prerequisites

* **Licensing:** Not provided in source documentation. [^1]
* **Permissions/Roles:** Not provided in source documentation. [^1]
* **Dependencies:** Microsoft Intune admin center to create/import policy sets and assign to groups; ACSC Office Hardening Guidelines policy JSON file; ACSC Windows Hardening Guidelines-Attack Surface Reduction policy JSON; Macros Enabled for Trusted Publishers policy JSON; OfficeMacroHardening-PreventActivationofOLE.ps1 PowerShell script; Graph Explorer for creating ASR policy; Groups: All Office Users; Group: Allow macro execution - Trusted Publisher. [^1]

[^1]:[Essential Eight configure Microsoft Office macro settings - Essential Eight](https://learn.microsoft.com/en-us/compliance/anz/e8-macro)

## Implementation Steps

### Intune-based macro signing and Trusted Publisher enforcement

1. Create a group to contain users that will be targeted with Office macro policies. Name the group: **All Office Users**.  
   This group will be used as the primary target for macro-blocking and other hardening policies. 

2. Stage 1 – Prepare and deploy Microsoft 365 Apps for Windows 10 and later
   1. Create the Microsoft 365 Apps for Windows 10 or later app in Intune:
      - Apps > Windows > Add > Microsoft 365 Apps.
   2. Include the Microsoft 365 Apps as required by your organization.
   3. Set Architecture to: **64-bit** (recommended).
   4. Set Update Channel to: **Semi-Annual Enterprise Channel** (recommended).
   5. Do not assign the application yet. Assignment is performed in Stage 3.
   Note: This stage aligns to policy targeting and app deployment planning. [^1]

   Reference: ACSC/Essential Eight guidance for macro hardening and Intune deployment steps. [^1]

3. Stage 2 – Import ACSC Office Hardening policy and script
   1. Save the ACSC Office Hardening Guidelines policy locally:
      - Policy file: ACSC Office Hardening Guidelines.json  
      - Source: https://github.com/microsoft/Intune-ACSC-Windows-Hardening-Guidelines/blob/main/office/policies/ACSC%20Office%20Hardening%20Guidelines.json
   2. In the Intune console, import the policy:
      - Devices > Windows > Configuration profiles > Create > Import Policy.
   3. Name the policy and browse for the policy file saved in step 3.1.
   4. Save the imported policy.
   5. Import the accompanying script to prevent activation of Object Linking and Embedding packages:
      - Script: [OfficeMacroHardening-PreventActivationofOLE.ps1](https://github.com/microsoft/Intune-ACSC-Windows-Hardening-Guidelines/blob/main/office/scripts/OfficeMacroHardening-PreventActivationofOLE.ps1)
   6. Run the script using the logged-on credentials: Yes.
   7. Do not enforce script signature check: No.
   8. Run script in 64-bit PowerShell Host: No.
   9. Assign the script to the group **All Office Users** (created in Stage 1).
   Notes: The policy and script are part of the ACSC hardening guidance. [^1]

   References:
   - ACSC Office Hardening Guidelines policy JSON. [^1]
   - Office Macro hardening script location. [^1]

4. Stage 3 – Create a policy set that combines Microsoft 365 Apps and ACSC hardening
   1. In Intune, navigate to Devices > Policy sets > Create.
   2. Under Application Management > Apps, select **Microsoft 365 Apps (for Windows 10 and later)** (the app created in Stage 1).
   3. Under Device Management > Device Configuration Profiles, select the ACSC Office Hardening policy (created in Stage 2).
   4. Under Assignments, select the group **All Office Users** (created in Stage 1).
   5. Import the Endpoint Security Attack Surface Reduction policy:
      - Source JSON: https://github.com/microsoft/Intune-ACSC-Windows-Hardening-Guidelines/blob/main/policies/ACSC%20Windows%20Hardening%20Guidelines-Attack%20Surface%20Reduction.json
   6. Open Graph Explorer, authenticate, and create a POST request to the ASR policy endpoint:
      - Endpoint: https://graph.microsoft.com/beta/deviceManagement/templates/0e237410-1367-4844-bd7f-15fb0f08943b/createInstance
   7. Paste the JSON from the Attack Surface Reduction policy file into the request body (as in step 5).
   8. Optionally modify the policy name in the request body.
   9. Assign the policy set to the group **All Office Users**.
   Note: The ASR policy is configured in audit mode to evaluate compatibility before enforcement. [^1]

   References:
   - ACSC Windows Hardening Guide – ASR policy JSON. [^1]
   - Intune/Azure Graph API guidance for policy creation. [^1]

5. Controlling macro execution – Block macros by default and allow Trusted Publishers
   1. Create a new group for trusted publishers that should be allowed to run macros signed by a trusted publisher. Name: **Allow macro execution - Trusted Publisher**.
   2. Stage 4 – Import and deploy All Macros Disabled policy
      1. Save the policy file: All Macros Disabled.json
         - Source: https://github.com/microsoft/Intune-ACSC-Windows-Hardening-Guidelines/blob/main/office/policies/All%20Macros%20Disabled.json
      2. In the Intune console, import the policy (Devices > Windows > Configuration profiles > Create > Import Policy).
      3. Name the policy, browse for the file, and Save.
      4. Assign the policy to the group **All Office Users** (Stage 1).
      5. Exclude the group **Allow macro execution - Trusted Publisher** from this policy.
      Note: This configuration blocks macros for all non-exempt users and enforces a Trusted Publisher exception path. [^1]

   2. Stage 5 – Import Macros Enabled for Trusted Publishers policy and assign to trusted group
      1. Save the policy file: Macros Enabled for Trusted Publishers.json
         - Source: https://github.com/microsoft/Intune-ACSC-Windows-Hardening-Guidelines/blob/main/office/policies/Macros%20Enabled%20for%20Trusted%20Publishers.json
      2. In the Intune console, import the policy (Devices > Windows > Configuration profiles > Create > Import Policy).
      3. Name the policy, browse for the file, and Save.
      4. Assign the policy to the group **Allow macro execution - Trusted Publisher** created in Step 5.1.
      5. Add one or more Trusted Publishers to the Trusted Publishers certificate store on devices (via Intune certificate distribution as described in vendor guidance or Group Policy guidance).
      6. Create and deploy separate policy configurations for each Trusted Publisher as needed.
      7. After importing the Trusted Publisher policy, specify one or more Trusted Publishers by signing macros and distributing the corresponding certificates to devices.
      8. Deployment rationale: Only macros signed by a trusted publisher are allowed to execute; untrusted macros are blocked.
      Notes: See Trusted Publishers guidance for adding and managing certificates. [^4]

   3. Validation and ongoing management
      1. Validate that Trusted Publishers are correctly registered on devices and certificates are within validity periods.
      2. Periodically review Trusted Publishers and remove any that are no longer required. [^4]

Notes
- The implementation aligns with the guidance that Intune can be used to enforce macro signing by trusted publishers and to block unsigned macros via ASR and macro policies. [^1] [^3]
- For details on trusted publisher concepts and how to manage them, refer to the Trusted publishers for Office files guidance. [^4]
- For the broader Intune security baseline context and macro policy options, see the Intune baseline documentation. [^3]

[^1]:Essential Eight configure Microsoft Office macro settings - Essential Eight | Microsoft Learn(https://learn.microsoft.com/en-us/compliance/anz/e8-macro)
[^2]:Macros from the internet are blocked by default in Office - Microsoft 365 Apps | Microsoft Learn(https://learn.microsoft.com/en-us/microsoft-365-apps/security/internet-macros-blocked)
[^3]:List of settings for the Microsoft 365 Apps for Enterprise security baseline in Intune - Microsoft Intune | Microsoft Learn(https://learn.microsoft.com/en-us/intune/intune-service/protect/security-baseline-v2-office-settings)
[^4]:Trusted publishers for Office files - Microsoft 365 Apps | Microsoft Learn(https://learn.microsoft.com/en-us/microsoft-365-apps/security/trusted-publisher)`;
    const contentWithoutFrontmatter = markdown.replace(/^---[\s\S]*?---\s*/m, '');
    document.getElementById('content').innerHTML = marked.parse(contentWithoutFrontmatter);
  </script>
</body>
</html>
