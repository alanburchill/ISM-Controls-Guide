<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Microsoft Office macro antivirus scanning is enabled. - ISM Controls Guide</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: #0d1117;
      min-height: 100vh;
      color: #e6edf3;
      text-align: left;
    }
    .header {
      background: #161b22;
      border-bottom: 1px solid #30363d;
      padding: 15px 40px;
      
      position: sticky;
      top: 0;
      z-index: 100;
      display: flex;
      align-items: center;
      gap: 20px;
    }
    .back-btn {
      background: #21262d; border: 1px solid #30363d;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
    }
    .back-btn:hover {
      transform: translateY(-2px);
      border-color: #58a6ff;
    }
    .header-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: #e6edf3;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 30px 20px;
    }
    .content-card {
      background: #161b22;
      border-radius: 6px; border: 1px solid #30363d;
      padding: 40px;
      
      text-align: left;
    }
    h1 {
      font-size: 1.8rem;
      font-weight: 700;
      color: #e6edf3;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #30363d;
    }
    h2 {
      font-size: 1.4rem;
      font-weight: 600;
      color: #e6edf3;
      margin-top: 30px;
      margin-bottom: 15px;
    }
    h3 {
      font-size: 1.2rem;
      font-weight: 600;
      color: #8b949e;
      margin-top: 25px;
      margin-bottom: 12px;
    }
    p { line-height: 1.7; margin-bottom: 15px; color: #8b949e; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      font-size: 0.95rem;
    }
    th, td {
      padding: 12px 15px;
      border: 1px solid #30363d;
      text-align: left;
    }
    th {
      background: #21262d; border: 1px solid #30363d;
      color: white;
      font-weight: 600;
    }
    tr:nth-child(even) { background: #161b22; } tr:nth-child(odd) { background: #0d1117; }
    ul, ol { margin: 15px 0; padding-left: 25px; }
    li { margin-bottom: 8px; line-height: 1.6; }
    a { color: #58a6ff; text-decoration: none; font-weight: 500; }
    a:hover { text-decoration: underline; }
    code {
      background: #21262d;
      padding: 3px 8px;
      border-radius: 4px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 0.9em;
    }
    pre {
      background: #161b22;
      color: #e6edf3;
      padding: 20px;
      border-radius: 10px;
      overflow-x: auto;
      margin: 20px 0;
    }
    pre code { background: none; padding: 0; color: inherit; }
    blockquote {
      border-left: 4px solid #58a6ff;
      padding: 15px 20px;
      margin: 20px 0;
      background: rgba(88, 166, 255, 0.1);
      border-radius: 0 8px 8px 0;
    }
    blockquote p { margin: 0; }
    hr { border: none; border-top: 1px solid #30363d; margin: 30px 0; }
    @media (max-width: 768px) {
      .header { padding: 15px 20px; flex-direction: column; align-items: flex-start; gap: 10px; }
      .content-card { padding: 25px; }
      h1 { font-size: 1.5rem; }
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <div class="header">
    <a href="../" class="back-btn">← Back to Controls</a>
    <span class="header-title">Microsoft Office macro antivirus scanning is enabled.</span>
  </div>
  <div class="container">
    <div class="content-card" id="content">
    </div>
  </div>
  <script>
    const markdown = `---
title: "Microsoft Office macro antivirus scanning is enabled. (ISM-1672)"
ism_control: "ISM-1672"
revision: "0"
updated: "Sep-21"
guideline: "Guidelines for system hardening"
section: "User application hardening"
topic: "Microsoft Office macros"
essential_eight:
  - "ML1"
  - "ML2"
  - "ML3"
pspf_levels:
  - "NC"
  - "OS"
  - "P"
  - "S"
  - "TS"
date_generated: "2025-12-25"
---
| Property | Value |
|----------|-------|
| **ISM Control** | ISM-1672 |
| **Revision** | 0 |
| **Updated** | Sep-21 |
| **Guideline** | Guidelines for system hardening |
| **Section** | User application hardening |
| **Topic** | Microsoft Office macros |
| **Essential Eight** | ML1, ML2, ML3 |
| **PSPF Levels** | NC, OS, P, S, TS |

## Summary

Microsoft Office macro antivirus scanning is enabled by configuring Defender Antivirus policy settings via Intune, including forcing runtime scans and enabling macro runtime scan scope for all documents; this requires Windows Defender to be running on the device. Implement the policy using Intune to deploy Defender Antivirus features and to schedule antivirus scans across devices. Macro-related activity and detections are logged via Defender for Endpoint when devices are managed by Intune, enabling review and response.[^1][^4][^5]

[^1]:[Essential Eight configure Microsoft Office macro settings](https://learn.microsoft.com/en-us/compliance/anz/e8-macro)
[^4]:[Schedule antivirus scans using Microsoft Intune](https://learn.microsoft.com/en-us/defender-endpoint/schedule-antivirus-scans-intune)
[^5]:[Review detected threats using the Microsoft Defender for Endpoint Antivirus and Intune integration](https://learn.microsoft.com/en-us/defender-endpoint/review-detected-threats)

## Design Decision

> [!NOTE] Enable macro antivirus scanning using Intune and Defender Antivirus settings to enforce runtime scanning of macros on all managed devices. This ensures Microsoft Office macros are scanned before execution, meeting the intended security posture for macro handling.

## Prerequisites

* **Licensing:** Not provided in source documentation.
* **Permissions/Roles:** Not provided in source documentation.
* **Dependencies:**
  1. Windows Defender Antivirus must be running on the device.[^1]
  2. Access to the Microsoft Intune admin center to configure scanning options and policy deployment.[^2]
  3. Import the ACSC Office Hardening Guidelines policy into Intune as part of the policy set.[^1]
  4. Create and target the All Office Users group in Intune for policy deployment.[^1]
  5. Configure the Attack Surface Reduction (ASR) policy via Intune/Graph as described to enable macro antivirus controls.[^1]

[^1]:Essential Eight configure Microsoft Office macro settings - Essential Eight | Microsoft Learn(https://learn.microsoft.com/en-us/compliance/anz/e8-macro)
[^2]:Configure scanning options for Microsoft Defender Antivirus - Microsoft Defender for Endpoint | Microsoft Learn(https://learn.microsoft.com/en-us/defender-endpoint/configure-advanced-scan-types-microsoft-defender-antivirus)

## Implementation Steps

### Stage 1: To create the policy to target desired users

1. Create a policy to be used to contain users that are targeted with the Office apps and the Office hardening policies. This group is referred to as **All Office Users**.[^1]

2. Create the Microsoft 365 Apps for Windows 10 or later app, under **Apps > Windows > Add > Microsoft 365 Apps**.[^1]

3. Include the Microsoft 365 Apps as required by your organization.[^1]

4. Set the architecture to: **64-bit** (recommended).[^1]

5. Set the Update Channel to: **Semi-Annual Enterprise Channel** (recommended).[^1]

6. Not assign the application. This is done in a later step.[^1]

### Stage 2: To import the ACSC hardening guideline policy

1. Save the ACSC Office Hardening Guidelines policy to your local device. You can obtain the policy from: [ACSC Office Hardening Guidelines.json](https://github.com/microsoft/Intune-ACSC-Windows-Hardening-Guidelines/blob/main/office/policies/ACSC%20Office%20Hardening%20Guidelines.json).[^1]

2. Navigate to the Microsoft Intune console.[^1]

3. Import a policy, under **Devices > Windows > Configuration profiles > Create > Import Policy**.[^1]

4. Name the policy, select Browse for files under Policy file and navigate to the saved policy from step 1.[^1]

5. Select **Save**.[^1]

##### Import script to prevent activation of Object Linking and Embedding packages

1. Navigate to **Devices > Scripts** and create a new PowerShell script. For reference, see the script: [OfficeMacroHardening-PreventActivationofOLE.ps1](https://github.com/microsoft/Intune-ACSC-Windows-Hardening-Guidelines/blob/main/office/scripts/OfficeMacroHardening-PreventActivationofOLE.ps1).[^1]

2. Import the PowerShell script to prevent activation of [Object Linking and Embedding packages](https://github.com/microsoft/Intune-ACSC-Windows-Hardening-Guidelines/blob/main/office/scripts/OfficeMacroHardening-PreventActivationofOLE.ps1).[^1]

3. Run this script using the logged on credentials: **Yes**.[^1]

4. Enforce script signature check: **No**.[^1]

5. Run script in 64-bit PowerShell Host: **No**.[^1]

6. Assign the PowerShell script to: **All Office Users** (created in Stage 1).[^1]

### Stage 3: Creation of the policy set combining Microsoft 365 Apps and ACSC Hardening Guideline policy

1. Navigate to **Devices > Policy sets > Create**.[^1]

2. Under **Application Management > Apps**, select **Microsoft 365 Apps (for Windows 10 and later)** (created in Stage 1).[^1]

3. Under **Device Management > Device Configuration Profiles**, select **ACSC Office Hardening** (created in Stage 2).[^1]

4. Under **Assignments** select **All Office Users** (created in Stage 1).[^1]

5. Import the Endpoint Security Attack Surface Reduction policy.[^1]

6. Navigate to Graph Explorer and authenticate.[^1]

7. Create a POST request, using the beta schema to the Attack Surface Reduction policy endpoint:  
   https://graph.microsoft.com/beta/deviceManagement/templates/0e237410-1367-4844-bd7f-15fb0f08943b/createInstance.  
   Copy the JSON in the [ACSC Windows Hardening Guidelines-Attack Surface Reduction.json](https://github.com/microsoft/Intune-ACSC-Windows-Hardening-Guidelines/blob/main/policies/ACSC%20Windows%20Hardening%20Guidelines-Attack%20Surface%20Reduction.json) and paste it in the request body. If necessary, modify the name value.[^1]

8. (Optional) modify the name value if necessary.[^1]

9. Assign the policy to: **All Office Users** (created in Stage 1).[^1]

10. Note: This Attack Surface Reduction (ASR) policy configures each of the ASR rules recommended by the ACSC in audit mode. ASR rules should be tested for compatibility issues in any environment before enforcement.[^1]

By following the document up to this point, the following additional mitigations are made:

| ISM control Mar 2025 | Control | Measure |
| --- | --- | --- |
| 1488 | Microsoft Office macros in files originating from the internet are blocked. | For each Office application, the following policy has been configured (via the*ACSC Office Hardening* policy):Block macros from running in Office files from the internet: Enabled[^1] |
| 1675 | Microsoft Office macros digitally signed by an untrusted publisher can't be enabled via the Message Bar or Backstage View. | For each Office application, the following policy has been configured (via the *ACSC Office Hardening* policy):Disable Trust Bar Notification for unsigned application: Enabled[^1] |
| 1672 | Microsoft Office macro antivirus scanning is enabled. | The following policies have been configured (via the *ACSC Office Hardening Guidelines* policy):Force Runtime AV Scan: Enabled; Macro Runtime Scan Scope: Enabled for all documents. Note: This requires Windows Defender to be running on the device.[^1] |
| 1673 | Microsoft Office macros are blocked from making Win32 API calls. | The following Attack Surface reduction rule has been configured (via the ASR policy):Block Win32 API calls from Office macro (92E97FA1-2EDF-4476-BDD6-9DD0B4DDDC7B) |[^1] |

### Controlling macro execution

The policy to block macros isn't included in the Policy Set. This provides the ability to selectively exempt groups of users that have a demonstrated business need to execute macros. All other users who don't have a demonstrated need are blocked from executing macros.

1. Create a group that contains users that are able to run Office macros if they're signed by a Trusted Publisher. This group is referred to as: **Allow macro execution - Trusted Publisher**.[^1]

2. Save the [All Macros Disabled policy](https://github.com/microsoft/Intune-ACSC-Windows-Hardening-Guidelines/blob/main/office/policies/All%20Macros%20Disabled.json) policy to your local device. [All Macros Disabled.json](https://github.com/microsoft/Intune-ACSC-Windows-Hardening-Guidelines/blob/main/office/policies/All%20Macros%20Disabled.json) .[^1]

3. Navigate to the Microsoft Intune console.[^1]

4. Import a policy, under **Devices > Windows > Configuration profiles > Create > Import Policy**.[^1]

5. Name the policy, select Browse for files under Policy file and navigate to the saved policy (from step 2).[^1]

6. Select **Save**.[^1]

7. Assign the All Macros Disabled policy to **All Office Users** (that was created at the start of this document).[^1]

8. Exclude the **Allow macro execution - Trusted Publisher** group (from step 1).[^1]

> Note: When signing macros, use the more secure version of the VBS project signature scheme: V3 signature.[^1]

By only allowing the execution of macros signed by a Trusted Publisher, the following additional mitigations are met:

| ISM control Mar 2025 | Control | Measure |
| --- | --- | --- |
| 1674 | Only Microsoft Office macros running from within a sandboxed environment, a Trusted Location or that are digitally signed by a Trusted Publisher are allowed to execute. | For each Office app, the following setting has been configured (via the Macros Enabled for Trusted Publishers policy):Disable all except digitally signed macros: Enabled[^1] |
| 1487 | Only privileged users responsible for checking that Microsoft Office macros are free of malicious code can write to and modify content within Trusted Locations. | Not applicable. Only macros signed by a Trusted Publisher are allowed to execute for select users. |[^1] |
| 1890 | Microsoft Office macros are checked to ensure they're free of malicious code before being digitally signed or placed within Trusted Locations. | An administrator launches macros on a device that has the ACSC Office Hardening policies applied, that is disconnected from the production environment and dedicated for the purpose of determining the safety of the macros prior to signing. |[^1] |

### Microsoft Office macros are checked to ensure they're free of malicious code before being digitally signed or placed within Trusted Locations

Implementation details

To import the Macros Enabled for Trusted Publishers policy, complete the following steps:

1. Save the [Macros Enabled for Trusted Publishers.json](https://github.com/microsoft/Intune-ACSC-Windows-Hardening-Guidelines/blob/main/office/policies/Macros%20Enabled%20for%20Trusted%20Publishers.json) policy to your local device.[^1]

2. Navigate to the Microsoft Intune console.[^1]

3. Import a policy, under *Devices > Windows > Configuration Profiles > Create > Import Policy*[^1]

4. Name the policy, select Browse for files under Policy file and navigate to the saved policy (from step 2)[^1]

5. Select Save[^1]

6. Assign the policy to the group: **Allow macro execution - Trusted Publisher**[^1]

After importing the Trusted Publisher policy, you'll need to specify one or more Trusted Publishers. To add a Trusted Publisher, follow the instructions for adding a certificate to the Trusted Publishers certificate store using Intune: Adding a certificate to trusted publishers using Intune. Create a new policy for each Trusted Publisher, rather than bundling multiple Publishers in the same policy. This simplifies identification of deployed Trusted Publishers and eases the removal of any Trusted Publishers that are no longer required. Deploy any Trusted Publishers certificate policies to the same group: Allow macro execution – Trusted Publisher.  
> Note: When signing macros, use the more secure version of the VBS project signature scheme: V3 signature. (Source guidance)[^1]

By only allowing macros signed by a Trusted Publisher, the following additional mitigations are met:

| ISM control Mar 2025 | Control | Measure |
| --- | --- | --- |
| 1674 | Only Microsoft Office macros running from within a sandboxed environment, a Trusted Location or that are digitally signed by a Trusted Publisher are allowed to execute. | For each Office app, the following setting has been configured (via the Macros Enabled for Trusted Publishers policy):Disable all except digitally signed macros: Enabled[^1] |
| 1487 | Only privileged users responsible for checking that Microsoft Office macros are free of malicious code can write to and modify content within Trusted Locations. | Not applicable. Only macros signed by a Trusted Publisher are allowed to execute for select users. |
| 1890 | Microsoft Office macros are checked to ensure they're free of malicious code before being digitally signed or placed within Trusted Locations. | An administrator launches macros on a device that has the ACSC Office Hardening policies applied, that is disconnected from the production environment and dedicated for the purpose of determining the safety of the macros prior to signing. |[^1] |

### Office macro execution logging

Microsoft Defender for Endpoint (MDE) can be used to obtain and retain logs from endpoints for detection of cyber security events. The integration between Microsoft Intune and MDE allows onboarding into MDE for Intune-managed devices.

1. Create a new Windows Configuration Profile with a type of **Template > Microsoft Defender for Endpoint (desktop devices running Windows 10 or later)**.[^4]

2. Set **Expedite telemetry reporting frequency** to **Enable**.[^4]

3. Assign the policy to a deployment group.[^4]

Once devices are onboarded to MDE, macro execution that matches ASR rules is logged in Defender for Endpoint. Alerts may be generated for detections.[^4]

### Validating list of trusted publishers

Validate the list of Trusted Publishers on a device with a user that has been allowed to execute macros from Trusted Publishers.

1. In the Trusted Publishers certificate store, verify that each of the Trusted Publisher certificates:

   - Is still required for macros in use in your organization.
   - Is still within its validity period.
   - Still has a valid chain of trust.

2. Remove any certificates that don't meet the previous criteria.  
   | ISM control Mar 2025 | Control | Measure |
   | --- | --- | --- |
   | 1676 | Microsoft Office’s list of trusted publishers is validated on an annual or more frequent basis. | An administrator verifies the certificates in the Trusted Publishers certificate store, ensuring that all certificates are still required and within their validity period. Remove any certificates and associated policies that are no longer required. |[^1] |

[^1]: Essential Eight configure Microsoft Office macro settings - Essential Eight | Microsoft Learn(https://learn.microsoft.com/en-us/compliance/anz/e8-macro)
[^2]: Configure scanning options for Microsoft Defender Antivirus - Microsoft Defender for Endpoint(https://learn.microsoft.com/en-us/defender-endpoint/configure-advanced-scan-types-microsoft-defender-antivirus)
[^3]: Configure Microsoft Defender Antivirus features - Microsoft Defender for Endpoint(https://learn.microsoft.com/en-us/defender-endpoint/configure-microsoft-defender-antivirus-features)
[^4]: Schedule antivirus scans using Microsoft Intune - Microsoft Defender for Endpoint(https://learn.microsoft.com/en-us/defender-endpoint/schedule-antivirus-scans-intune)`;
    const contentWithoutFrontmatter = markdown.replace(/^---[\s\S]*?---\s*/m, '');
    document.getElementById('content').innerHTML = marked.parse(contentWithoutFrontmatter);
  </script>
</body>
</html>
